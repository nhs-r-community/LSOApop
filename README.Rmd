---
output: "github_document"
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# NHSRpopulation <a href='https://nhsrcommunity.com/'><img src='man/figures/logo.png' align="right" height="60" /></a>

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

The goal of `NHSRpopulation` is to make population estimates for **Lower layer Super Output Areas (LSOA)** and their **Indices of Multiple Deprivation (IMD)** easily available in R.
In its first iteration this package was data saved from [https://www.gov.uk/government/statistics/english-indices-of-deprivation-2019](https://www.gov.uk/government/statistics/english-indices-of-deprivation-2019) and has subsequently been moved to the API [https://services1.arcgis.com/] to keep the data up to date (although it only updated every few years) and give access to all the nations across the UK including Wales, Scotland, Northern Ireland as well as England.

## Installation

You can install the current version of `NHSRpopulation` from [GitHub](https://github.com/nhs-r-community/NHSRpopulation) with:

``` r
# install.packages("remotes")
remotes::install_github("nhs-r-community/NHSRpopulation")
```

## Example

```{r}
# Load the package
library(NHSRpopulation)
```

### Indices of Multiple Deprivation (IMD)

To get the IMD scores (raw scores and ranked deciles) for a dataset run the following code to generate some random example postcodes:

```{r}
library(purrr)
library(tibble)
library(PostcodesioR)

postcodes <- purrr::map_chr(
  1:10,
  .f = ~PostcodesioR::random_postcode() |> 
    purrr::pluck(1) 
) 

tibble_postcodes <- postcodes |> 
  tibble::as_tibble()
```

Then, using the `get_imd()` function for a vector (returning just the first five columns):

```{r}
NHSRpopulation::get_imd(postcodes) |> 
  dplyr::select(1:5)
```

Or with a data frame (returning just the first five columns):

```{r}
NHSRpopulation::get_imd(tibble_postcodes$value) |> 
  dplyr::select(1:5)
```

This function can be used to fix missing postcodes as some are terminated or are invalid:

```{r}
postcodes <- c("HD1 2UT", "HD1 2UU", "HD1 2UV")

NHSRpopulation::get_imd(postcodes) |> 
  dplyr::select(1:5)

```

Currently, although the postcode is fixed with the column `new_postcode` the IMD is not overwritten.

## Lower Super Output area (LSOA)

To return the `IMD`, `imd_decile` and `imd_quintile` for LSOAs this can be as a vector:

```{r}
# Example LSOAs from each England Decile group
lsoa_imd <- c("E01000002",
              "E01000001",
              "E01000117",
              "E01000119",
              "E01000069",
              "E01000070",
              "E01000066",
              "E01000005",
              "E01000008",
              "E01000048")

get_lsoa(lsoa_imd) |> 
  head(10) # first 10 rows
```

Or from a data frame:

```{r}

tibble_lsoa_imd <- lsoa_imd |> 
  as_tibble()

get_lsoa(tibble_lsoa_imd$value) |> 
  head(10)

```

The functions return everything in those LSOAs and if you would like to return some random postcodes from each decile:

```{r}
get_lsoa(lsoa_imd, return = "random")
```

Or just the first postcode that appears in each decile:

```{r}
get_lsoa(lsoa_imd, return = "first")
```

## Sources of Data

The original source of the data provided in this R package is available [here](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/lowersuperoutputareamidyearpopulationestimates) and licenced under the [Open Government Licence v3.0](http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/).


## Code of Conduct
  
Please note that the `NHSRpopulation` project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). 
By contributing to this project, you agree to abide by its terms.

## Special note of thanks

This package was originally created by [Milan Wiedemann](https://github.com/milanwiedemann).
